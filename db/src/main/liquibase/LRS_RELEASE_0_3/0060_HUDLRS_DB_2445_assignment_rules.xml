<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">
    <changeSet context="All"  author="astrauss" id="HUDLRS_2357_0002" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
		<![CDATA[
CREATE TABLE SCORING_MODEL_VERSION_STATUS_REF(
	SCORING_MODEL_VERSION_STATUS_ID UNIQUEIDENTIFIER NOT NULL,
	CODE VARCHAR(30) NOT NULL,
	DESCRIPTION VARCHAR(30) NOT NULL
)
ALTER TABLE SCORING_MODEL_VERSION_STATUS_REF ADD CONSTRAINT SCORING_MODEL_VERSION_STATUS_PK PRIMARY KEY NONCLUSTERED(SCORING_MODEL_VERSION_STATUS_ID)
ALTER TABLE SCORING_MODEL_VERSION_STATUS_REF ADD CONSTRAINT SCORING_MODEL_VERSION_STATUS_UQ_CODE UNIQUE(CODE)
GO
INSERT INTO SCORING_MODEL_VERSION_STATUS_REF(SCORING_MODEL_VERSION_STATUS_ID, CODE, DESCRIPTION) VALUES
	(NEWID(), 'ACTIVE', 'Active'),
	(NEWID(), 'DRAFT', 'Draft'),
	(NEWID(), 'ARCHIVED', 'Archived')
GO

ALTER TABLE SCORING_MODEL_VERSION ADD SCORING_MODEL_VERSION_STATUS_ID UNIQUEIDENTIFIER NULL;
ALTER TABLE SCORING_MODEL_VERSION ADD CONSTRAINT SCORING_MODEL_VERSION_FK_SCORING_MODEL_VERSION_STATUS_ID FOREIGN KEY(SCORING_MODEL_VERSION_STATUS_ID) REFERENCES SCORING_MODEL_VERSION_STATUS_REF(SCORING_MODEL_VERSION_STATUS_ID)
GO
UPDATE SCORING_MODEL_VERSION SET SCORING_MODEL_VERSION_STATUS_ID = (SELECT SCORING_MODEL_VERSION_STATUS_ID FROM SCORING_MODEL_VERSION_STATUS_REF WHERE CODE = 'ACTIVE')
GO
ALTER TABLE SCORING_MODEL_VERSION ALTER COLUMN SCORING_MODEL_VERSION_STATUS_ID UNIQUEIDENTIFIER NOT NULL;
ALTER TABLE SCORING_MODEL_VERSION DROP COLUMN STATUS
		]]>
        </sql>
    </changeSet>
</databaseChangeLog>
