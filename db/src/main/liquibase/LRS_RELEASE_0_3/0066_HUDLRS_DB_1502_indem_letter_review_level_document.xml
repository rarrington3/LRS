<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">
    <changeSet context="All"  author="jordanchavez@kpmg.com" id="HUDLRS_1502_0001" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
			<![CDATA[
ALTER TABLE DOCUMENT ADD REVIEW_LEVEL_ID UNIQUEIDENTIFIER NULL
ALTER TABLE DOCUMENT ADD CONSTRAINT DOCUMENT_FK_REVIEW_LEVEL_ID FOREIGN KEY(REVIEW_LEVEL_ID) REFERENCES REVIEW_LEVEL(REVIEW_LEVEL_ID)
ALTER TABLE DOCUMENT DROP COLUMN INDEMNIFICATION_AGREEMENT_NUMBER
GO

DROP TABLE RVW_LVL_INDEM_AUD
GO

ALTER TABLE RVW_LVL_INDEM ADD INDEMNIFICATION_AGREEMENT_NUMBER BIGINT NOT NULL
GO
			]]>
        </sql>
    </changeSet>
    <changeSet context="All"  author="jordanchavez@kpmg.com" id="HUDLRS_1502_0002" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
		<![CDATA[
EXEC SP_RENAME 'RVW_LVL_INDEM', 'INDEMNIFICATION'
GO
ALTER TABLE INDEMNIFICATION DROP CONSTRAINT RVW_LVL_INDEM_PK
ALTER TABLE INDEMNIFICATION DROP COLUMN TERMS_OF_AGREEMENT_CD
ALTER TABLE INDEMNIFICATION DROP COLUMN INDEM_START_CD
ALTER TABLE INDEMNIFICATION DROP COLUMN INDEM_TYPE
ALTER TABLE INDEMNIFICATION DROP COLUMN EXPIRATION_DATE
ALTER TABLE INDEMNIFICATION ADD INDEMNIFICATION_ID UNIQUEIDENTIFIER NOT NULL
ALTER TABLE INDEMNIFICATION ADD CONSTRAINT INDEMNIFICATION_PK PRIMARY KEY NONCLUSTERED(INDEMNIFICATION_ID)
ALTER TABLE INDEMNIFICATION ADD CONSTRAINT INDEMNIFICATION_UQ_REVIEW_LEVEL_ID UNIQUE(REVIEW_LEVEL_ID)
ALTER TABLE INDEMNIFICATION ADD LENDER_SIGNER_USER_ID VARCHAR(6) NULL
ALTER TABLE INDEMNIFICATION ADD LENDER_SIGNER_NAME VARCHAR(100) NULL
ALTER TABLE INDEMNIFICATION ADD LENDER_SIGNED_DATE DATETIME NULL
ALTER TABLE INDEMNIFICATION ADD FHA_SIGNER_PERSONNEL_ID UNIQUEIDENTIFIER NULL
ALTER TABLE INDEMNIFICATION ADD CONSTRAINT INDEMNIFICATION_FK_FHA_SIGNER_PERSONNEL_ID FOREIGN KEY(FHA_SIGNER_PERSONNEL_ID) REFERENCES PERSONNEL(PERSONNEL_ID)
ALTER TABLE INDEMNIFICATION ADD FHA_SIGNER_NAME VARCHAR(100) NULL
ALTER TABLE INDEMNIFICATION ADD FHA_SIGNER_DIVISION VARCHAR(3) NULL
ALTER TABLE INDEMNIFICATION ADD FHA_SIGNED_DATE DATETIME NULL
GO
EXEC SP_RENAME 'INDEMNIFICATION_TYPE_REF.INDEMNIFICATION_TYPE_DESCRIPTION', 'DESCRIPTION'
ALTER TABLE INDEMNIFICATION_TYPE_REF ADD CODE VARCHAR(30) NULL
GO
UPDATE INDEMNIFICATION_TYPE_REF SET CODE = '5_YEAR' WHERE DESCRIPTION = '5 Year'
UPDATE INDEMNIFICATION_TYPE_REF SET CODE = 'LIFE_OF_LOAN', DESCRIPTION = 'Life of Loan' WHERE DESCRIPTION = 'Life Of Loan'
ALTER TABLE INDEMNIFICATION_TYPE_REF ALTER COLUMN CODE VARCHAR(30) NOT NULL
ALTER TABLE INDEMNIFICATION_TYPE_REF ADD CONSTRAINT INDEMNIFICATION_TYPE_REF_UQ_CODE UNIQUE(CODE)
ALTER TABLE REVIEW DROP COLUMN JBPM_PROCESS_ID
ALTER TABLE REVIEW_LEVEL ALTER COLUMN RATING_ID UNIQUEIDENTIFIER NOT NULL
ALTER TABLE REVIEW_LEVEL ALTER COLUMN RATING_ID UNIQUEIDENTIFIER NOT NULL
GO
EXEC SP_RENAME 'RQST_FROM_LENDER', 'LENDER_REQUEST'
EXEC SP_RENAME 'RQST_FROM_LENDER_STATUS_REF', 'LENDER_REQUEST_STATUS_REF'
GO
EXEC SP_RENAME 'LENDER_REQUEST_STATUS_REF.RQST_FROM_LENDER_STATUS_ID', 'LENDER_REQUEST_STATUS_ID'
EXEC SP_RENAME 'RQST_FROM_LENDER_PK', 'LENDER_REQUEST_PK'
EXEC SP_RENAME 'LENDER_REQUEST.REQUEST_ID', 'LENDER_REQUEST_ID'
EXEC SP_RENAME 'LENDER_REQUEST.RQST_FROM_LENDER_STATUS_ID', 'LENDER_REQUEST_STATUS_ID'
ALTER TABLE LENDER_REQUEST ADD CONSTRAINT LENDER_REQUEST_FK_LENDER_REQUEST_STATUS_ID FOREIGN KEY(LENDER_REQUEST_STATUS_ID) REFERENCES LENDER_REQUEST_STATUS_REF(LENDER_REQUEST_STATUS_ID)
ALTER TABLE LENDER_REQUEST DROP COLUMN STATUS
ALTER TABLE LENDER_REQUEST ALTER COLUMN REQUESTED_DATE DATETIME NOT NULL
GO
INSERT INTO LENDER_REQUEST_STATUS_REF(LENDER_REQUEST_STATUS_ID, CODE, DESCRIPTION) VALUES (NEWID(), 'CANCELLED', 'Cancelled')
GO
ALTER TABLE REVIEW_LEVEL DROP COLUMN INDEM_DATE
GO
INSERT INTO BATCH_STATUS_REF(BATCH_STATUS_ID, CODE, DESCRIPTION) VALUES (NEWID(), 'CANCELLED', 'Cancelled')
ALTER TABLE INDEMNIFICATION DROP COLUMN INDEM_STATUS
EXEC SP_RENAME 'INDEMNIFICATION.INDEM_TRANSFERABLE_IND', 'TRANSFERRABLE_IND'
EXEC SP_RENAME 'INDEMNIFICATION.INDEM_DATE', 'START_DATE'
ALTER TABLE PERSONNEL_ASSIGNMENT_TYPE ADD CONSTRAINT PERSONNEL_ASSIGNMENT_TYPE_UQ_PERSONNEL_ID_ASSIGNMENT_TYPE_CD UNIQUE(PERSONNEL_ID, ASSIGNMENT_TYPE_CD)
UPDATE DICT_METADATA_FIELD SET DB_COLUMN = 'PRODUCT_TYPE_CD' WHERE ENTITY_NAME = 'Case Summary for Review Level' AND DB_COLUMN = 'PRODUCT_TYPE_ID'
EXEC SP_RENAME 'DOCUMENT_TYPE_REF.DOCUMENT_TYPE_CD', 'CODE'
		]]>
        </sql>
    </changeSet>
</databaseChangeLog>
