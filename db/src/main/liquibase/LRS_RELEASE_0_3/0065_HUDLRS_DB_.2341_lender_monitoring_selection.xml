<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">
    <changeSet context="All"  author="jordanchavez@kpmg.com" id="HUDLRS_2341_0001" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
			<![CDATA[
ALTER TABLE SELECTION_REASON DROP CONSTRAINT SELECTION_REASON_FK_UNIVERSE_ID
ALTER TABLE SELECTION_REASON DROP COLUMN UNIVERSE_ID
ALTER TABLE SELECTION_REASON DROP COLUMN MODEL_SCORE_THRESHOLD
ALTER TABLE SELECTION_REASON DROP COLUMN MIN_QUANTITY
ALTER TABLE SELECTION_REASON DROP COLUMN SAMPLING_PERCENTAGE
GO
ALTER TABLE SCORING_MODEL_TYPE_REF ALTER COLUMN CODE VARCHAR(50) NOT NULL
GO
INSERT INTO SCORING_MODEL_TYPE_REF(SCORING_MODEL_TYPE_ID, CODE, DESCRIPTION) VALUES
	(NEWID(), 'LENDER_MONITORING_SELECTION', 'Lender Monitoring'),
	(NEWID(), 'ENDORSEMENT_SELECTION', 'Endorsement Selection'),
	(NEWID(), 'EARLY_CLAIM_SELECTION', 'Early Claim Selection'),
	(NEWID(), 'EARLY_PENDING_DEFAULT_SELECTION', 'Early Pending Default Selection'),
	(NEWID(), 'NATIONAL_QC_SELECTION', 'National QC Selection'),
	(NEWID(), 'NONPERFORMING_SELECTION', 'Nonperforming Selection'),
	(NEWID(), 'FACTOR', 'Scoring factor in other models'),
	(NEWID(), 'ASSIGNMENT', 'Assignment'),
	(NEWID(), 'DISTRIBUTION', 'Distribution')
GO
ALTER TABLE SCORING_MODEL ADD CODE VARCHAR(50) NULL
GO
UPDATE SCORING_MODEL SET CODE = 'DEFECT_PROBABILITY_FWD',              SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'ENDORSEMENT_SELECTION')           WHERE DESCRIPTION = 'Defect Probability Fwd'
UPDATE SCORING_MODEL SET CODE = 'LENDER_INCREASED',	                   SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'ENDORSEMENT_SELECTION')           WHERE DESCRIPTION = 'Lender Increased'
UPDATE SCORING_MODEL SET CODE = 'UNDERWRITER_INCREASED',               SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'ENDORSEMENT_SELECTION')           WHERE DESCRIPTION = 'Underwriter Increased'
UPDATE SCORING_MODEL SET CODE = 'RANDOM',                              SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'ENDORSEMENT_SELECTION')           WHERE DESCRIPTION = 'Random'
UPDATE SCORING_MODEL SET CODE = 'EARLY_CLAIM',                         SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'EARLY_CLAIM_SELECTION')           WHERE DESCRIPTION = 'Early Claim'
UPDATE SCORING_MODEL SET CODE = 'EARLY_PAYMENT_DEFAULT',               SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'EARLY_PENDING_DEFAULT_SELECTION') WHERE DESCRIPTION = 'Early Payment Default'
UPDATE SCORING_MODEL SET CODE = 'NATIONAL_QC',                         SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'NATIONAL_QC_SELECTION')           WHERE DESCRIPTION = 'National QC'
UPDATE SCORING_MODEL SET CODE = 'NONPERFORMING',                       SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'NONPERFORMING_SELECTION')         WHERE DESCRIPTION = 'NonPerforming Loan'
UPDATE SCORING_MODEL SET CODE = 'DEFECT_PROBABILITY_REV',              SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'FACTOR')                          WHERE DESCRIPTION = 'Defect Probability Rev'
UPDATE SCORING_MODEL SET CODE = 'LENDER_MONITORING_FWD_SERVICING',     SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'LENDER_MONITORING_SELECTION')     WHERE DESCRIPTION = 'Lender Monitoring Fwd Servicing'
UPDATE SCORING_MODEL SET CODE = 'LENDER_MONITORING_REV_SERVICING',     SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'LENDER_MONITORING_SELECTION')     WHERE DESCRIPTION = 'Lender Monitoring Rev Servicing'
UPDATE SCORING_MODEL SET CODE = 'LENDER_MONITORING_FWD_UNDERWRITING',  SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'LENDER_MONITORING_SELECTION')     WHERE DESCRIPTION = 'Lender Monitoring Fwd Underwriting'
UPDATE SCORING_MODEL SET CODE = 'LENDER_MONITORING_REV_UNDERWRITING',  SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'LENDER_MONITORING_SELECTION')     WHERE DESCRIPTION = 'Lender Monitoring Rev Underwriting'
UPDATE SCORING_MODEL SET CODE = 'LENDER_MONITORING_REV_COMPREHENSIVE', SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'LENDER_MONITORING_SELECTION')     WHERE DESCRIPTION = 'Lender Monitoring Rev Comprehensive'
UPDATE SCORING_MODEL SET CODE = 'LENDER_MONITORING_FWD_COMPREHENSIVE', SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'LENDER_MONITORING_SELECTION')     WHERE DESCRIPTION = 'Lender Monitoring Fwd Comprehensive'
UPDATE SCORING_MODEL SET CODE = 'ASSIGNMENT',                          SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'ASSIGNMENT')                      WHERE DESCRIPTION = 'Assignment Scoring'
UPDATE SCORING_MODEL SET CODE = 'DISTRIBUTION',                        SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'DISTRIBUTION')                    WHERE DESCRIPTION = 'Case Distribution'
GO
ALTER TABLE SCORING_MODEL ADD CONSTRAINT SCORING_MODEL_UQ_CODE UNIQUE(CODE)
GO
UPDATE SCORING_MODEL SET ORDER_NUMBER = 17 WHERE CODE = 'DISTRIBUTION'
GO
DELETE FROM SCORING_MODEL_TYPE_REF WHERE CODE IN ('SCOR', 'SLCT', 'ASGN', 'DIST')
GO
ALTER TABLE SCORING_MODEL ADD PRODUCT_TYPE_ID UNIQUEIDENTIFIER NULL
ALTER TABLE SCORING_MODEL ADD CONSTRAINT SCORING_MODEL_FK_PRODUCT_TYPE_ID FOREIGN KEY(PRODUCT_TYPE_ID) REFERENCES PRODUCT_TYPE_REF(PRODUCT_TYPE_ID)
GO
UPDATE SCORING_MODEL SET PRODUCT_TYPE_ID = (SELECT PRODUCT_TYPE_ID FROM PRODUCT_TYPE_REF WHERE PRODUCT_TYPE_CD = 'PRCHS') WHERE CODE LIKE 'LENDER_MONITORING_FWD_%'
UPDATE SCORING_MODEL SET PRODUCT_TYPE_ID = (SELECT PRODUCT_TYPE_ID FROM PRODUCT_TYPE_REF WHERE PRODUCT_TYPE_CD = 'HECM') WHERE CODE LIKE 'LENDER_MONITORING_REV_%'
GO
ALTER TABLE SCORING_MODEL ADD REVIEW_TYPE_ID UNIQUEIDENTIFIER NULL
ALTER TABLE SCORING_MODEL ADD CONSTRAINT SCORING_MODEL_FK_REVIEW_TYPE_ID FOREIGN KEY(REVIEW_TYPE_ID) REFERENCES REVIEW_TYPE_REF(REVIEW_TYPE_ID)
GO
UPDATE SCORING_MODEL SET REVIEW_TYPE_ID = (SELECT REVIEW_TYPE_ID FROM REVIEW_TYPE_REF WHERE REVIEW_TYPE_CD = 'S') WHERE CODE LIKE 'LENDER_MONITORING_%_SERVICING'
UPDATE SCORING_MODEL SET REVIEW_TYPE_ID = (SELECT REVIEW_TYPE_ID FROM REVIEW_TYPE_REF WHERE REVIEW_TYPE_CD = 'U') WHERE CODE LIKE 'LENDER_MONITORING_%_UNDERWRITING'
UPDATE SCORING_MODEL SET REVIEW_TYPE_ID = (SELECT REVIEW_TYPE_ID FROM REVIEW_TYPE_REF WHERE REVIEW_TYPE_CD = 'C') WHERE CODE LIKE 'LENDER_MONITORING_%_COMPREHENSIVE'
GO
ALTER TABLE SCORING_MODEL ADD SELECTION_REASON_ID UNIQUEIDENTIFIER NULL
ALTER TABLE SCORING_MODEL ADD CONSTRAINT SCORING_MODEL_FK_SELECTION_REASON_ID FOREIGN KEY(SELECTION_REASON_ID) REFERENCES SELECTION_REASON(SELECTION_REASON_ID)
GO
UPDATE SCORING_MODEL SET SELECTION_REASON_ID = (SELECT SELECTION_REASON_ID FROM SELECTION_REASON SR WHERE SR.CODE = 'LENDER_MONITORING') WHERE CODE = 'LENDER_MONITORING_FWD_SERVICING'
UPDATE SCORING_MODEL SET SELECTION_REASON_ID = (SELECT SELECTION_REASON_ID FROM SELECTION_REASON SR WHERE SR.CODE = 'LENDER_MONITORING') WHERE CODE = 'LENDER_MONITORING_REV_SERVICING'
UPDATE SCORING_MODEL SET SELECTION_REASON_ID = (SELECT SELECTION_REASON_ID FROM SELECTION_REASON SR WHERE SR.CODE = 'LENDER_MONITORING') WHERE CODE = 'LENDER_MONITORING_REV_COMPREHENSIVE'
UPDATE SCORING_MODEL SET SELECTION_REASON_ID = (SELECT SELECTION_REASON_ID FROM SELECTION_REASON SR WHERE SR.CODE = 'LENDER_MONITORING') WHERE CODE = 'LENDER_MONITORING_FWD_COMPREHENSIVE'
UPDATE SCORING_MODEL SET SELECTION_REASON_ID = (SELECT SELECTION_REASON_ID FROM SELECTION_REASON SR WHERE SR.CODE = 'LENDER_MONITORING') WHERE CODE = 'LENDER_MONITORING_FWD_UNDERWRITING'
UPDATE SCORING_MODEL SET SELECTION_REASON_ID = (SELECT SELECTION_REASON_ID FROM SELECTION_REASON SR WHERE SR.CODE = 'LENDER_MONITORING') WHERE CODE = 'LENDER_MONITORING_REV_UNDERWRITING'
UPDATE SCORING_MODEL SET SELECTION_REASON_ID = (SELECT SELECTION_REASON_ID FROM SELECTION_REASON SR WHERE SR.CODE = 'NATIONAL_QC') WHERE CODE = 'NATIONAL_QC'
UPDATE SCORING_MODEL SET SELECTION_REASON_ID = (SELECT SELECTION_REASON_ID FROM SELECTION_REASON SR WHERE SR.CODE = 'EARLY_CLAIM') WHERE CODE = 'EARLY_CLAIM'
UPDATE SCORING_MODEL SET SELECTION_REASON_ID = (SELECT SELECTION_REASON_ID FROM SELECTION_REASON SR WHERE SR.CODE = 'EARLY_PAYMENT_DEFAULT') WHERE CODE = 'EARLY_PAYMENT_DEFAULT'
UPDATE SCORING_MODEL SET SELECTION_REASON_ID = (SELECT SELECTION_REASON_ID FROM SELECTION_REASON SR WHERE SR.CODE = 'MONTHLY_RISK_THRESHOLD') WHERE CODE = 'DEFECT_PROBABILITY_FWD'
UPDATE SCORING_MODEL SET SELECTION_REASON_ID = (SELECT SELECTION_REASON_ID FROM SELECTION_REASON SR WHERE SR.CODE = 'LENDER_INCREASED_SAMPLING') WHERE CODE = 'LENDER_INCREASED'
UPDATE SCORING_MODEL SET SELECTION_REASON_ID = (SELECT SELECTION_REASON_ID FROM SELECTION_REASON SR WHERE SR.CODE = 'UNDERWRITER_DECREASED_SAMPLING') WHERE CODE = 'UNDERWRITER_INCREASED'
UPDATE SCORING_MODEL SET SELECTION_REASON_ID = (SELECT SELECTION_REASON_ID FROM SELECTION_REASON SR WHERE SR.CODE = 'OTHER_NON_PERFORMING') WHERE CODE = 'NONPERFORMING'
UPDATE SCORING_MODEL SET SELECTION_REASON_ID = (SELECT SELECTION_REASON_ID FROM SELECTION_REASON SR WHERE SR.CODE = 'MONTHLY_RANDOM') WHERE CODE = 'RANDOM'
GO
			]]>
        </sql>
    </changeSet>
</databaseChangeLog>
