<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">
    <changeSet context="TEST"  author="jordanchavez@kpmg.com" id="HUDLRS_2138_0001" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
		<![CDATA[
EXEC SP_RENAME 'FHA_MANUAL_SELECTION_REQUEST', 'MANUAL_SELECTION_REQUEST'
EXEC SP_RENAME 'FHA_MANUAL_SELECTION_REQUEST_PK', 'MANUAL_SELECTION_REQUEST_PK'
EXEC SP_RENAME 'FHA_MANUAL_SELECTION_REQUEST_FK_REVIEW_LOCATION_ID', 'MANUAL_SELECTION_REQUEST_FK_REVIEW_LOCATION_ID'
EXEC SP_RENAME 'FHA_MANUAL_SELECTION_REQUEST_FK_REVIEW_TYPE_ID', 'MANUAL_SELECTION_REQUEST_FK_REVIEW_TYPE_ID'
EXEC SP_RENAME 'FHA_MANUAL_SELECTION_REQUEST_FK_SELECTION_REASON_ID', 'MANUAL_SELECTION_REQUEST_FK_SELECTION_REASON_ID'
EXEC SP_RENAME 'FHA_MANUAL_SELECTION_REQUEST_FK_SELECTION_REQUEST_ID', 'MANUAL_SELECTION_REQUEST_FK_SELECTION_REQUEST_ID'
EXEC SP_RENAME 'FHA_MANUAL_SELECTION_REQUEST_FK_SELECTION_SUB_REASON_ID', 'MANUAL_SELECTION_REQUEST_FK_SELECTION_SUB_REASON_ID'
GO

ALTER TABLE MANUAL_SELECTION_REQUEST ADD CREATED_BY CHAR(6) NULL
ALTER TABLE MANUAL_SELECTION_REQUEST ADD CREATED_TS DATETIME NULL
ALTER TABLE MANUAL_SELECTION_REQUEST ADD UPDATED_BY CHAR(6) NULL
ALTER TABLE MANUAL_SELECTION_REQUEST ADD UPDATED_TS DATETIME NULL
GO
UPDATE M
SET M.CREATED_BY = S.CREATED_BY, M.CREATED_TS = S.CREATED_TS, M.UPDATED_BY = S.UPDATED_BY, M.UPDATED_TS = S.UPDATED_TS
FROM MANUAL_SELECTION_REQUEST M
INNER JOIN SELECTION_REQUEST S ON S.SELECTION_REQUEST_ID = M.SELECTION_REQUEST_ID
GO
ALTER TABLE MANUAL_SELECTION_REQUEST ALTER COLUMN CREATED_BY CHAR(6) NOT NULL
ALTER TABLE MANUAL_SELECTION_REQUEST ALTER COLUMN CREATED_TS DATETIME NOT NULL
ALTER TABLE MANUAL_SELECTION_REQUEST ALTER COLUMN UPDATED_BY CHAR(6) NOT NULL
ALTER TABLE MANUAL_SELECTION_REQUEST ALTER COLUMN UPDATED_TS DATETIME NOT NULL
GO

ALTER TABLE LENDER_MONITORING_SELECTION_REQUEST ALTER COLUMN REVIEW_LOCATION_ID UNIQUEIDENTIFIER NOT NULL
ALTER TABLE LENDER_MONITORING_SELECTION_REQUEST ALTER COLUMN REVIEW_TYPE_ID UNIQUEIDENTIFIER NOT NULL
ALTER TABLE LENDER_MONITORING_SELECTION_REQUEST ALTER COLUMN START_DT DATETIME NOT NULL
ALTER TABLE LENDER_MONITORING_SELECTION_REQUEST ALTER COLUMN END_DT DATETIME NOT NULL
GO

ALTER TABLE LENDER_SELF_REPORT_SELECTION_REQUEST DROP COLUMN FRAUD_DETECTED
ALTER TABLE LENDER_SELF_REPORT_SELECTION_REQUEST ADD FRAUD_DETECTED_IND CHAR(1) NOT NULL
ALTER TABLE LENDER_SELF_REPORT_SELECTION_REQUEST DROP COLUMN LOAN_COVERED_UNDER_SETTLEMTN_WITH_HUD 
ALTER TABLE LENDER_SELF_REPORT_SELECTION_REQUEST ADD LOAN_COVERED_UNDER_SETTLEMTN_WITH_HUD_IND CHAR(1) NOT NULL
GO

ALTER TABLE PRODUCT_TYPE_REF ALTER COLUMN PRODUCT_TYPE_CD VARCHAR(5) NOT NULL
ALTER TABLE PRODUCT_TYPE_REF ALTER COLUMN DESCRIPTION VARCHAR(50) NOT NULL
GO

UPDATE PRODUCT_TYPE_REF SET PRODUCT_TYPE_CD = 'REFI' WHERE PRODUCT_TYPE_CD = 'REFI '
UPDATE PRODUCT_TYPE_REF SET PRODUCT_TYPE_CD = 'HECM' WHERE PRODUCT_TYPE_CD = 'HECM '
GO
		]]>
        </sql>
    </changeSet>
    <changeSet context="TEST"  author="jordanchavez@kpmg.com" id="HUDLRS_2138_0002" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
		<![CDATA[
UPDATE DICT_METADATA_ENTITY SET DB_VIEW_OR_TABLE = 'MANUAL_SELECTION_REQUEST' WHERE DB_VIEW_OR_TABLE = 'FHA_MANUAL_SELECTION_REQUEST'
INSERT INTO DICT_METADATA_FIELD(ENTITY_NAME, DB_COLUMN, FIELD_NAME, DISPLAY_NAME, DESCRIPTION, CREATED_BY, UPDATED_BY, CREATED_TS, UPDATED_TS) SELECT E.ENTITY_NAME, 'CREATED_BY', 'CREATED_BY', 'CREATED_BY', 'CREATED_BY', 'jchav', 'jchav', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP FROM DICT_METADATA_ENTITY E WHERE (E.DB_VIEW_OR_TABLE = 'MANUAL_SELECTION_REQUEST')
INSERT INTO DICT_METADATA_FIELD(ENTITY_NAME, DB_COLUMN, FIELD_NAME, DISPLAY_NAME, DESCRIPTION, CREATED_BY, UPDATED_BY, CREATED_TS, UPDATED_TS) SELECT E.ENTITY_NAME, 'CREATED_TS', 'CREATED_TS', 'CREATED_TS', 'CREATED_TS', 'jchav', 'jchav', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP FROM DICT_METADATA_ENTITY E WHERE (E.DB_VIEW_OR_TABLE = 'MANUAL_SELECTION_REQUEST')
INSERT INTO DICT_METADATA_FIELD(ENTITY_NAME, DB_COLUMN, FIELD_NAME, DISPLAY_NAME, DESCRIPTION, CREATED_BY, UPDATED_BY, CREATED_TS, UPDATED_TS) SELECT E.ENTITY_NAME, 'UPDATED_BY', 'UPDATED_BY', 'UPDATED_BY', 'UPDATED_BY', 'jchav', 'jchav', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP FROM DICT_METADATA_ENTITY E WHERE (E.DB_VIEW_OR_TABLE = 'MANUAL_SELECTION_REQUEST')
INSERT INTO DICT_METADATA_FIELD(ENTITY_NAME, DB_COLUMN, FIELD_NAME, DISPLAY_NAME, DESCRIPTION, CREATED_BY, UPDATED_BY, CREATED_TS, UPDATED_TS) SELECT E.ENTITY_NAME, 'UPDATED_TS', 'UPDATED_TS', 'UPDATED_TS', 'UPDATED_TS', 'jchav', 'jchav', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP FROM DICT_METADATA_ENTITY E WHERE (E.DB_VIEW_OR_TABLE = 'MANUAL_SELECTION_REQUEST')
DELETE F FROM DICT_METADATA_FIELD F INNER JOIN DICT_METADATA_ENTITY E ON (E.ENTITY_NAME = F.ENTITY_NAME) WHERE  (F.DB_COLUMN = 'FRAUD_DETECTED' AND E.DB_VIEW_OR_TABLE = 'LENDER_SELF_REPORT_SELECTION_REQUEST')
INSERT INTO DICT_METADATA_FIELD(ENTITY_NAME, DB_COLUMN, FIELD_NAME, DISPLAY_NAME, DESCRIPTION, CREATED_BY, UPDATED_BY, CREATED_TS, UPDATED_TS) SELECT E.ENTITY_NAME, 'FRAUD_DETECTED_IND', 'FRAUD_DETECTED_IND', 'FRAUD_DETECTED_IND', 'FRAUD_DETECTED_IND', 'jchav', 'jchav', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP FROM DICT_METADATA_ENTITY E WHERE (E.DB_VIEW_OR_TABLE = 'LENDER_SELF_REPORT_SELECTION_REQUEST')
DELETE F FROM DICT_METADATA_FIELD F INNER JOIN DICT_METADATA_ENTITY E ON (E.ENTITY_NAME = F.ENTITY_NAME) WHERE  (F.DB_COLUMN = 'LOAN_COVERED_UNDER_SETTLEMTN_WITH_HUD' AND E.DB_VIEW_OR_TABLE = 'LENDER_SELF_REPORT_SELECTION_REQUEST') 
INSERT INTO DICT_METADATA_FIELD(ENTITY_NAME, DB_COLUMN, FIELD_NAME, DISPLAY_NAME, DESCRIPTION, CREATED_BY, UPDATED_BY, CREATED_TS, UPDATED_TS) SELECT E.ENTITY_NAME, 'LOAN_COVERED_UNDER_SETTLEMTN_WITH_HUD_IND', 'LOAN_COVERED_UNDER_SETTLEMTN_WITH_HUD_IND', 'LOAN_COVERED_UNDER_SETTLEMTN_WITH_HUD_IND', 'LOAN_COVERED_UNDER_SETTLEMTN_WITH_HUD_IND', 'jchav', 'jchav', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP FROM DICT_METADATA_ENTITY E WHERE (E.DB_VIEW_OR_TABLE = 'LENDER_SELF_REPORT_SELECTION_REQUEST')
		]]>
        </sql>
    </changeSet>
</databaseChangeLog>
