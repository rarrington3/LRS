<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">
    <changeSet context="ALL"  author="jordanchavez@kpmg.com" id="HUDLRS_1089_0001_create_JOB_TYPE_REF" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
		<![CDATA[
			CREATE TABLE JOB_TYPE_REF(
				JOB_TYPE_ID UNIQUEIDENTIFIER NOT NULL,
				CODE VARCHAR(4) NOT NULL,
				DESCRIPTION VARCHAR(50) NOT NULL
			)
			ALTER TABLE JOB_TYPE_REF ADD CONSTRAINT JOB_TYPE_REF_PK PRIMARY KEY NONCLUSTERED(JOB_TYPE_ID)
			ALTER TABLE JOB_TYPE_REF ADD CONSTRAINT JOB_TYPE_REF_UQ_CODE UNIQUE(CODE)

		]]>
        </sql>
    </changeSet>
    <changeSet context="ALL"  author="jordanchavez@kpmg.com" id="HUDLRS_1089_0002_insert_JOB_TYPE_REF" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
		<![CDATA[
			INSERT INTO JOB_TYPE_REF(JOB_TYPE_ID, CODE, DESCRIPTION) VALUES
				(NEWID(), 'ENDR', 'Monthly Endorsement'),
				(NEWID(), 'ECLM', 'Monthly Early Claim'),
				(NEWID(), 'EPDF', 'Monthly Early Pending Default'),
				(NEWID(), 'AGGR', 'Daily Aggregation'),
				(NEWID(), 'DIST', 'Daily Distribution'),
				(NEWID(), 'ASGN', 'Daily Assignment')
		]]>
        </sql>
    </changeSet>
    <changeSet context="ALL"  author="jordanchavez@kpmg.com" id="HUDLRS_1089_0003_create_JOB" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
		<![CDATA[
			CREATE TABLE JOB(
				JOB_ID UNIQUEIDENTIFIER NOT NULL,
				JOB_TYPE_ID UNIQUEIDENTIFIER NOT NULL,
				MANUALLY_INVOKED BIT NOT NULL,
				JBPM_PROCESS_ID BIGINT NULL,
				COMPLETED_DT DATETIME NOT NULL,
				CREATED_DT DATETIME NOT NULL,
			)
			ALTER TABLE JOB ADD CONSTRAINT JOB_PK PRIMARY KEY NONCLUSTERED(JOB_ID)
			ALTER TABLE JOB ADD CONSTRAINT JOB_FK_JOB_TYPE_ID FOREIGN KEY(JOB_TYPE_ID) REFERENCES JOB_TYPE_REF(JOB_TYPE_ID)
		]]>
        </sql>
    </changeSet>
    <changeSet context="ALL"  author="jordanchavez@kpmg.com" id="HUDLRS_1089_0004_alter_LOAN_SELECTION_CASE_SUMMARY" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
		<![CDATA[
			ALTER TABLE LOAN_SELECTION_CASE_SUMMARY ADD JOB_ID UNIQUEIDENTIFIER NULL
			ALTER TABLE LOAN_SELECTION_CASE_SUMMARY ADD CONSTRAINT LOAN_SELECTION_CASE_SUMMARY_FK_JOB_ID FOREIGN KEY(JOB_ID) REFERENCES JOB(JOB_ID)

			ALTER TABLE LOAN_SELECTION_CASE_SUMMARY ADD CONSTRAINT LOAN_SELECTION_CASE_SUMMARY_UQ_CASE_NUMBER_JOB_ID UNIQUE(CASE_NUMBER, JOB_ID)
		]]>
        </sql>
    </changeSet>
    <changeSet context="ALL"  author="jordanchavez@kpmg.com" id="HUDLRS_1089_0005_alter_MODEL_SCORE" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
		<![CDATA[
			ALTER TABLE MODEL_SCORE ADD MODEL_SCORE_ID UNIQUEIDENTIFIER NOT NULL
			ALTER TABLE MODEL_SCORE DROP CONSTRAINT MODEL_SCORE_PK
			ALTER TABLE MODEL_SCORE ADD CONSTRAINT MODEL_SCORE_PK PRIMARY KEY NONCLUSTERED(MODEL_SCORE_ID)

			ALTER TABLE MODEL_SCORE ADD SELECTION_ID UNIQUEIDENTIFIER NOT NULL
			ALTER TABLE MODEL_SCORE ADD CONSTRAINT MODEL_SCORE_FK_SELECTION_ID FOREIGN KEY(SELECTION_ID) REFERENCES LOAN_SELECTION_CASE_SUMMARY(SELECTION_ID)

			ALTER TABLE MODEL_SCORE ADD CONSTRAINT MODEL_SCORE_UQ_SELECTION_ID_MODEL_ID UNIQUE(SELECTION_ID, MODEL_ID)

			ALTER TABLE MODEL_SCORE DROP COLUMN CASE_NUMBER
		]]>
        </sql>
    </changeSet>
    <changeSet context="ALL"  author="jordanchavez@kpmg.com" id="HUDLRS_1089_0006_alter_LOAN_SELECTION" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
		<![CDATA[
			ALTER TABLE LOAN_SELECTION_PENDING ADD LOAN_SELECTION_PENDING_ID UNIQUEIDENTIFIER NOT NULL
			ALTER TABLE LOAN_SELECTION_PENDING DROP CONSTRAINT LOAN_SELECTION_PENDING_PK
			ALTER TABLE LOAN_SELECTION_PENDING ADD CONSTRAINT LOAN_SELECTION_PENDING_PK PRIMARY KEY NONCLUSTERED(LOAN_SELECTION_PENDING_ID)

			ALTER TABLE LOAN_SELECTION_PENDING ADD SELECTION_ID UNIQUEIDENTIFIER NOT NULL
			ALTER TABLE LOAN_SELECTION_PENDING ADD CONSTRAINT LOAN_SELECTION_PENDING_FK_SELECTION_ID FOREIGN KEY(SELECTION_ID) REFERENCES LOAN_SELECTION_CASE_SUMMARY(SELECTION_ID)

			ALTER TABLE LOAN_SELECTION_PENDING ADD CONSTRAINT LOAN_SELECTION_PENDING_UQ_SELECTION_ID_SLCTN_REASON_ID UNIQUE(SELECTION_ID, SLCTN_REASON_ID)

			ALTER TABLE LOAN_SELECTION_PENDING DROP COLUMN CASE_NUMBER
		]]>
        </sql>
    </changeSet>
    <changeSet context="ALL"  author="jordanchavez@kpmg.com" id="HUDLRS_1089_0007_drop_unused" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
		<![CDATA[
			DROP TABLE PROC_UNIVERSE
			DROP TABLE SELECTION_UNIVERSE_CASES
		]]>
        </sql>
    </changeSet>
</databaseChangeLog>
