<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">
    <changeSet context="ALL"  author="jordanchavez@kpmg.com" id="HUDLRS_1959_001_create_SCORING_MODEL_REF" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
		<![CDATA[
			CREATE TABLE SCORING_MODEL_TYPE_REF(
				SCORING_MODEL_TYPE_ID UNIQUEIDENTIFIER NOT NULL,
				CODE VARCHAR(4) NOT NULL,
				DESCRIPTION VARCHAR(50) NOT NULL
			)
			ALTER TABLE SCORING_MODEL_TYPE_REF ADD CONSTRAINT SCORING_MODEL_TYPE_REF_PK PRIMARY KEY NONCLUSTERED(SCORING_MODEL_TYPE_ID)
			ALTER TABLE SCORING_MODEL_TYPE_REF ADD CONSTRAINT SCORING_MODEL_TYPE_REF_UQ_CODE UNIQUE(CODE)
			INSERT INTO SCORING_MODEL_TYPE_REF(SCORING_MODEL_TYPE_ID, CODE, DESCRIPTION) VALUES
				(NEWID(), 'SCOR', 'Scoring'),
				(NEWID(), 'SLCT', 'Selection'),
				(NEWID(), 'ASGN', 'Assignment'),
				(NEWID(), 'DIST', 'Distribution')
			INSERT INTO DICT_METADATA_ENTITY(ENTITY_NAME, DB_VIEW_OR_TABLE, DESCRIPTION, CREATED_BY, UPDATED_BY, CREATED_TS, UPDATED_TS) VALUES
				('Scoring Model Type Ref', 'SCORING_MODEL_TYPE_REF', 'Scoring Model Type Ref', 'jchav', 'jchav', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
			INSERT INTO DICT_METADATA_FIELD(ENTITY_NAME, DB_COLUMN, DISPLAY_NAME, FIELD_NAME, CREATED_BY, UPDATED_BY, CREATED_TS, UPDATED_TS) VALUES
				('Scoring Model Type Ref', 'SCORING_MODEL_TYPE_ID', 'Scoring Model Type ID', 'Scoring Model Type ID', 'jchav', 'jchav', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
				('Scoring Model Type Ref', 'CODE',                  'Code',                  'Code',                  'jchav', 'jchav', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP),
				('Scoring Model Type Ref', 'DESCRIPTION',           'Description',           'Description',           'jchav', 'jchav', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
		]]>
        </sql>
    </changeSet>
    <changeSet context="ALL"  author="jordanchavez@kpmg.com" id="HUDLRS_1959_002_alter_SCORING_MODEL" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
		<![CDATA[
			ALTER TABLE SCORING_MODEL ADD SCORING_MODEL_TYPE_ID UNIQUEIDENTIFIER NULL
			ALTER TABLE SCORING_MODEL ADD CONSTRAINT SCORING_MODEL_FK_SCORING_MODEL_TYPE_ID FOREIGN KEY(SCORING_MODEL_TYPE_ID) REFERENCES SCORING_MODEL_TYPE_REF(SCORING_MODEL_TYPE_ID)
			INSERT INTO DICT_METADATA_FIELD(ENTITY_NAME, DB_COLUMN, DISPLAY_NAME, FIELD_NAME, CREATED_BY, UPDATED_BY, CREATED_TS, UPDATED_TS) VALUES
				('Scoring Model', 'SCORING_MODEL_TYPE_ID', 'Scoring Model Type ID', 'Scoring Model Type ID', 'jchav', 'jchav', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
		]]>
        </sql>
    </changeSet>
    <changeSet context="ALL"  author="jordanchavez@kpmg.com" id="HUDLRS_1959_003_update_SCORING_MODEL" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
		<!-- TODO https://jira.cynergy.com/jira/browse/HUDLRS-1960: we don't have all of these filled out -->
		<![CDATA[
			UPDATE SCORING_MODEL SET SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'SCOR') WHERE DESCRIPTION = 'Defect Probability Fwd'
			UPDATE SCORING_MODEL SET SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'SCOR') WHERE DESCRIPTION = 'Defect Probability Rev'
			UPDATE SCORING_MODEL SET SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'SLCT') WHERE DESCRIPTION = 'National QC'
			UPDATE SCORING_MODEL SET SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'SLCT') WHERE DESCRIPTION = 'Early Claim'
			UPDATE SCORING_MODEL SET SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'SLCT') WHERE DESCRIPTION = 'Early Payment Default'
			UPDATE SCORING_MODEL SET SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'SLCT') WHERE DESCRIPTION = 'Lender Increased'
			UPDATE SCORING_MODEL SET SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'SLCT') WHERE DESCRIPTION = 'Underwriter Increased'
			UPDATE SCORING_MODEL SET SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'SLCT') WHERE DESCRIPTION = 'Random'
			UPDATE SCORING_MODEL SET SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'ASGN') WHERE DESCRIPTION = 'Assignment Scoring'
			UPDATE SCORING_MODEL SET SCORING_MODEL_TYPE_ID = (SELECT SCORING_MODEL_TYPE_ID FROM SCORING_MODEL_TYPE_REF WHERE CODE = 'DIST') WHERE DESCRIPTION = 'Case Distribution'
		]]>
        </sql>
    </changeSet>
    <changeSet context="ALL"  author="jordanchavez@kpmg.com" id="HUDLRS_1959_004_update_SELECTION_PARAMETERS" objectQuotingStrategy="QUOTE_ALL_OBJECTS">
        <sql>
		<!-- TODO https://jira.cynergy.com/jira/browse/HUDLRS-1960: we don't have all of these filled out -->
		<![CDATA[
			UPDATE SELECTION_PARAMETERS SET UNIVERSE_ID = (SELECT UNIVERSE_ID FROM UNIVERSE_REF WHERE CODE = 'ENDR') WHERE SELECTION_REASON_NAME IN ('Lender Increased Sampling', 'Underwriter Increased Sampling', 'Monthly Risk Threshold', 'Monthly Random')
			UPDATE SELECTION_PARAMETERS SET UNIVERSE_ID = (SELECT UNIVERSE_ID FROM UNIVERSE_REF WHERE CODE = 'ECLM') WHERE SELECTION_REASON_NAME IN ('Early Claims')
			UPDATE SELECTION_PARAMETERS SET UNIVERSE_ID = (SELECT UNIVERSE_ID FROM UNIVERSE_REF WHERE CODE = 'EPDF') WHERE SELECTION_REASON_NAME IN ('Early Payment Defaults')
			UPDATE SELECTION_PARAMETERS SET UNIVERSE_ID = (SELECT UNIVERSE_ID FROM UNIVERSE_REF WHERE CODE = 'LMON') WHERE SELECTION_REASON_NAME IN ('Lender Monitoring')
		]]>
        </sql>
    </changeSet>
</databaseChangeLog>
